# CHFEN: Conditional Hybrid Fusion Emotion Net for Short Video Affective Computing

## 概述
这是我曾经尝试投递到 CVPR[2025] 的一篇文章的工程部分。在那个时候，我对于多模态非常感兴趣。我设计了一个可以接受和处理多种模态数据的神经网络。

这个网络的目的是去分析一个视频所表现的情感。
我构建了一些网络爬虫爬取了很多来自短视频平台的视频。然后，我构建了一个数据pipeline，去处理、分析、标注这些数据。
这个网络中的一些模块是基于当时我能够找到的热门encoder-only架构的模型。这个网络经过各种数据处理、编码、融合，最终得到结果。

然而，由于这个数据集的质量本身不够好(UGC的特性)，以及标注质量也很糟糕(我后来做了很多分析和实验证明了这一点)，我很难在如此糟糕的基础上训练出一个可用的模型。同时，在那个时期，encoder-only架构的模型已经过时了。在不使用迁移学习的方法的情况下，从头去训练一个深度学习网络，总是会去面临数据集规模和模型大小的权衡。(那么，使用多模型的LLMs以及使用多模态的embedding-model就会是一个更好的选择。)因为这些原因，模型的表现最终并不够好。

从现在的视角来看，这个工程相当糟糕。你可以从我的其他仓库中看到各种我构建的更好的工具，和完全更好的项目。总体而言，这个仓库记录了我第一次完成深度学习项目和AI论文的投递。因为这个项目的规范性对于现在的我而言并不行，同时我也没有心思整理甚至重构这个工程，所以你可专注于仅查看实现的思路和方法。


## 思路
### 动机
#### 数据集的缺失
在数据集方面，现有的工作并没有对于整理过新闻视频的情感数据集。

### 数据集

#### 数据集分析

#### pipeline构建

### 模型架构


## 原始论文


## 项目内容
这个项目结构是我在当时学会了python包控制和pytorch组件后设计的。对于更好的我现在深度学习项目的管理，你可以查看 [Flash-Boilerplate](https://github.com/yuliu625/Yu-Flash-Boilerplate) 。

### configs
数据集构建、模型设置、实验运行相关的设置。我尝试使用 `yaml` 文件进行构建，通过 `omegaconf` 进行加载。但由于当时对于深度学习项目需要的配置和流程控制的理解不到位，配置文件是分散并且存在不统一、无用配置的情况。

### data_processing
数据集处理。当时的处理代码应该比这里记录的要更多，这里是我能直接收集到的。这里的各种脚本文件分为3种: 
- 处理爬虫爬取结果。
- 数据清洗和预处理。
- 数据集分析和简单标注。

### dataset
数据加载方法的构建和管理。这个任务的难点在于:
- 存在多种模态的数据。
- 存在时序信息需要整合。

各种数据需要在输入给模型之前就做好统一处理，并且根据各种条件进行控制(尤其是消融实验)。如果你需要根据自己的项目进行改写，更好的组织方法可以分层为:
- 数据对象的构建: 基于相关工具加载数据的方法。
- dataset对象的构建: 各标签和统一模态的管理方法。
- dataloader对象的构建: 构建dataloader的方法，尤其是collate_fn针对多模态信息和时序信息的整合。

### embedding
只是当时对这个包起了这个名字，而实际的含义是: 基于预训练的encoder-only模型进行针对性的特征提取。

我选择了 `transformers` 库中提供的模型，分别对于具体的模态进行编码。这里的实现方法是，在dataset中实现编码，因此实际上有很多问题。
更好的实践是，在完成数据集分析和处理之后，对数据集进行预编码，以 tensor 形式缓存。这会以本地大量的缓存以及灵活性为代价，以及其他的例如动态在数据加载阶段使用数据增强的方法会有很多限制，对于数据集需要进行版本控制，对于新的测试数据集需要额外构建和处理。但是如果数据构建pipeline是足够有效的，这样的空间换时间的做法是非常值得的。

### model
我以各种组件的方式定义了各个模块，由于当时并没有对 python 中的 package 概念有非常深入的理解，因此所有的组件均放在同一层。

模型的架构分为2层:
- 特征融合阶段: 直接对于单一模态的encoder编码的embedding结果进行处理。
- 决策融合阶段: 对特征融合阶段的结果进行综合计算。

### scripts
执行脚本。当时的做法仅仅是: 使用 `nohup` 持续训练模型。

对于更好的做法，你可以直接以 python 构建具体执行任务的脚本，例如数据处理、执行训练等。
同时，也可额外构建一个进程管理工具，以实现训练任务的定时任务和自动重启。

### utils
对于原生 `pytorch` 没有实现但经常会使用的功能的实现。

### tests
数据加载和模型训练的测试。这时候我还未理解在项目中插入断言的好处，也并没有学会使用 `pytest` 进行单元测试和集成测试。因此，这里主要的做法是基于ipynb查看输出是否符合预期。

## 如何运行


## 小结


## 更多项目
### 改进工作

### 我现在的深度学习项目


