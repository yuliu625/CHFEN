# CHFEN: Conditional Hybrid Fusion Emotion Net for Short Video Affective Computing

## 项目概述
本项目展示了 CHFEN (Conditional Hybrid Fusion Emotion Net)，这是一个为分析用户生成内容 (UGC) 短视频中多模态情感而设计的深度学习模型。

CHFEN 是我早期对多模态学习的探索性尝试，其核心价值在于以下两大创新点:
- 理论指导的数据集构建: 将心理学中的 普鲁切克情感轮 (Plutchik's Wheel of Emotions) 引入情感标注，构建出更具细粒度解释性的短视频情感数据集。
- 三层混合融合模型: 设计基于 Encoder-Only 架构的三层融合网络，通过条件查询机制 (Conditional Query Mechanism)，高效处理和融合视觉、听觉和文本等多模态信息。

项目定位: 该项目曾作为我对多模态学习的首次深度探索，并尝试投递至 CVPR [2025] (未接收)。尽管模型的表现受限于当时的时代背景和早期数据集的质量，但本项目详尽记录了从数据爬取、理论框架建立到模型训练的全流程，是作者在多模态深度学习领域的首次工程实践与宝贵的经验总结里程碑。


## 核心工作一: 数据集构建与理论改进
本项目致力于解决现有情感数据集的局限性，构建一个更贴近真实世界、更具理论基础的 UGC 短视频情感数据集。
### 弥补真实世界情感数据集的空白
现有多模态情感数据集主要基于影视作品，缺乏针对新闻短视频等 UGC 场景的数据。这带来了两大挑战:
- 挑战: 现有多模态情感数据集主要基于影视作品，缺乏针对新闻短视频等 UGC 场景的数据，导致模型泛化能力不足。
- 贡献: 通过网络爬虫构建了一个UGC 短视频数据集，旨在捕获更真实、更具时效性的情感信息。

### 基于理论的标注框架：Plutchik's 情感轮
多数数据集的粗粒度单一标签忽略了多模态（视觉、听觉、文本）之间的语义差异甚至冲突。为解决这一问题，我们构建了一个全新的理论标注体系:
- 理论基础: 引入心理学中的 普鲁切克情感轮 (Plutchik's Wheel of Emotions)，构建通用且可扩展的标注体系。
- 解释性: 能够更好地适应多模态标签冲突场景，提供比单一标签更精细的多维度解释性标注。
- 通用性与扩展性: 为情感标注提供坚实的心理学理论支撑，允许根据任务需求进行灵活降维或细粒度扩展。

### 多模态数据处理与特征提取 Pipeline
为支持模型输入和理论标注，我们构建了以下数据处理流程:
- 爬虫与数据清洗: 对爬取结果进行处理，基于视频元数据进行筛选。
- 数据增强与生成: 针对视频模态和音频模态进行特征提取和预处理。
  - 音频处理: 背景音乐与人声分离。
  - 文本提取: 使用识别算法提取视频中的硬字幕（所有文本）为 .srt 文件。
  - 视觉追踪: 提取和追踪视频中的独特人物。
- 多轮人工标注: 根据我建立的理论框架和严格的规范流程，委托外部工作室进行了多维度、细粒度的情感标注。


## 核心工作二: CHFEN 模型架构与多模态融合策略
CHFEN 采用当时流行的 Encoder-Only 架构作为基础，设计了清晰的三层混合融合结构来有效整合多模态信息。
### 三层混合融合架构
CHFEN 采取混合融合策略，将多模态数据在特征和决策两个层次进行融合:
- 编码层: 模态特征提取。使用基于 Transformer 的 Encoder-Only 预训练模型对各模态数据进行独立的 Embedding 编码。
- 特征融合层: 低层次表征融合。对关联更紧密的模态表征（如文本-视觉、视觉-听觉）进行低层次融合。
- 决策融合层: 任务决策整合。在更高层面对所有融合后的特征进行最终整合，输出任务结果（情感分类）。
### 模型构建思路
- 基础机制: 基于当时 Attention 机制在 Cross-Attention 上的优越性，天生适合多模态交叉检索和信息融合。
- 模态编码: 利用单模态预训练模型作为基础，保证各模态的初始表征质量。
- 混合融合的动机: 融合不仅发生在底层特征层面，也在最终决策层面进行综合考量，这样多模态信息融合更加充分，也可以提升模型的鲁棒性。
### 基于条件查询的融合机制
为了解决简单融合中模态权重失衡和交叉信息学习效率低的痛点，CHFEN 引入了有目的的指导机制:
- 痛点: 简单融合难以学习有效的交叉信息，且易导致模态权重失衡（如图像信息过多导致权重偏高）
- 机制: 引入一个代表全局信息的条件查询 (Conditional Query)，在早期有目的地指导底层的模态融合。
- 实践: 这个全局表征具体选择了多模态 Embedding Model 编码后的新闻标题，它为后续的时序视频信息融合提供了稳定的、有偏好的先验指导。


## 经验总结与反思
本项目是我在深度学习和 AI 论文投递上的第一次实践，其暴露的挑战对理解实际应用中的局限性至关重要。

**核心教训: 数据质量是深度学习任务的上限。**

模型的最终表现不理想，核心归因于 数据质量 与 方法论 的局限性:
### 数据质量瓶颈与工程挑战
- UGC 数据噪音大: 短视频数据本身的噪音（画质、剪辑、音乐）对特征提取造成干扰。
- 缺乏数据预分析: 在进行复杂的处理和标注前，未能对数据集性质进行充分的预分析，导致清洗工作不够彻底。
- 标注质量控制不足: 早期标注流程不够严格，导致标签的可信度和一致性存在严重问题，难以支撑复杂模型的训练。
### 方法论的局限性:
在 2022年之后，仅使用 Encoder-Only 架构从头训练或简单迁移学习的网络，已经难以与当时兴起的 多模态LLMs 和 Embedding Models 的强大泛化能力匹敌。

*总结: 巧妇难为无米之炊。糟糕的数据集（无论数据本身还是标签质量）是任何深度学习项目难以逾越的障碍。*


## 项目结构
该项目结构是我早期学习 pytorch 组件化和 python 包控制的方法。
- configs: 爬虫结果处理、数据清洗、简单分析脚本。存在配置分散、冗余配置等问题。你可以以集中化、模块化的配置管理。
- data_processing: 爬虫结果处理、数据清洗、简单分析脚本。
- dataset: 数据加载、时序信息整合。存在的问题是在加载阶段进行编码，效率低下。你可以改进为，在数据集分析处理后，进行预编码，以 Tensor 形式缓存。(当然，这需要更好的数据类控制。你可以参考我现在项目的标准化规范做法。这对消融实验是必要的。)
- embedding: 基于预训练模型的特征提取。
- model: 基于pytorch的模型定义，以组件和层级的方式构建的模型。
- utils: 对原生 Pytorch 未实现的通用功能
- tests: 基于 IPynb 的简单测试。更好的做法是使用pytest进行标准的单元测试和集成测试。
- scripts: 模型执行脚本。

## 如何运行
1. 构建 config_experiments 文件夹中的 baseline_model.yaml 样例配置文件。
2. 在 main.py 中设置使用对应的配置文件。
3. 运行 main.py 文件（可使用 nohup 命令启动）。

## 原始论文
TODO: 在重新整理科研写作思路后，我计划将本项目相关的原始论文发布到 Arxiv 上。

## 更多项目与当前工作
本项目记录了成长的历程碑，但其规范性和方法论已无法满足我目前的标准。如果你对更现代、更高效的深度学习和 AI 工程实践感兴趣，可以参考我的其他项目
### 改进工作
在我的视角，encoder-only的模型只能做简单的任务。在2022年之后，如果不是在具体领域有很多积累，最好的做法是使用LLM相关的新技术。
- [MEM-V-Agent](https://github.com/yuliu625/MEM-V-Agent): 这篇工作的后续改进工作，构建具有多模态分析能力的agent去完成这项任务。但由于现实的很多具体原因，这篇工作未能完成。我将我所有的研究资料和代码均放在了以下仓库，如果你需要，可以进行查看。
### 我现在的深度学习项目
- [Flash-Boilerplate](https://github.com/yuliu625/Yu-Flash-Boilerplate): 我的最新深度学习项目仓库模板，结构规范化和组件化程度更高。
- [Deep-Learning-Toolkit](https://github.com/yuliu625/Yu-Deep-Learning-Toolkit): 我构建的常见可以使用深度学习工具的仓库。
### 更多工具仓库
- [Data-Science-Toolkit](https://github.com/yuliu625/Yu-Data-Science-Toolkit): 我为数据科学任务构建的工具集。
- [Agent-Development-Toolkit](https://github.com/yuliu625/Yu-Agent-Development-Toolkit): 专注于LLM和Agent构建的工具集。
### 现有工作
- [Simulate-the-Prisoners-Dilemma-with-Agents](https://github.com/yuliu625/Simulate-the-Prisoners-Dilemma-with-Agents): 我基于`autogen`的早期尝试，研究了 LLM 智能体在囚徒困境等简单博弈场景下的行为。
- [World-of-Six](https://github.com/yuliu625/World-of-Six): 关于智能体在具有网络效应环境下的决策行为的研究。(论文被 SWAIB[2025] 接收)
### 正在进行中的项目(未来开源)
- 关于 LLM-based Agent 在具有网络效应的环境下的预期行为的研究
- 构建 Multi-agent System 来分析财务报告的文档智能项目。

欢迎查阅，并期待交流。

